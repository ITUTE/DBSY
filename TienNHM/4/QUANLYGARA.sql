CREATE DATABASE QUANLYGARA
GO

USE QUANLYGARA
GO

-----------------------------------------------------------------------------------
-- Tạo cấu trúc bảng THO
CREATE TABLE THO(
	MaTho		CHAR(10) PRIMARY KEY,
	TenTho		NVARCHAR(30),
	Nhom		CHAR(5),
	NhomTruong	CHAR(10) NULL
)
GO

-----------------------------------------------------------------------------------
-- Nhập dữ liệu cho bảng THO
INSERT INTO THO VALUES ('T001', N'Nguyễn Trường An', 'N01', 'T010')
INSERT INTO THO VALUES ('T002', N'Trần Thanh Tài', 'N01', 'T010')
INSERT INTO THO VALUES ('T003', N'Lê Thanh Danh', 'N02', 'T005')
INSERT INTO THO VALUES ('T004', N'Cao Thành Tâm', 'N02', 'T005')
INSERT INTO THO VALUES ('T005', N'Lý Thành Đạt', 'N02', NULL)
INSERT INTO THO VALUES ('T006', N'Nguyễn Trung Sơn', 'N03', NULL)
INSERT INTO THO VALUES ('T007', N'Lý Văn Đông', 'N03', 'T006')
INSERT INTO THO VALUES ('T008', N'Trần Văn Thịnh', 'N03', 'T006')
INSERT INTO THO VALUES ('T009', N'Nguyễn Văn Phát', 'N03', 'T006')
INSERT INTO THO VALUES ('T010', N'Lê Văn Đạt', 'N01', NULL)
GO

-----------------------------------------------------------------------------------
-- Thêm khóa ngoại cho bảng THO
ALTER TABLE THO WITH CHECK ADD FOREIGN KEY(NhomTruong) REFERENCES THO(MaTho)
GO

-----------------------------------------------------------------------------------
-- Tạo cấu trúc bảng CONGVIEC
CREATE TABLE CONGVIEC(
	MaCV		CHAR(10) PRIMARY KEY,
	NoiDungCV	NVARCHAR(100)
)
GO

-----------------------------------------------------------------------------------
-- Nhập dữ liệu cho bảng CONGVIEC
INSERT INTO CONGVIEC VALUES ('CV00001', N'Thay nhớt')
INSERT INTO CONGVIEC VALUES ('CV00002', N'Thay lốp xe')
INSERT INTO CONGVIEC VALUES ('CV00003', N'Rửa xe')
INSERT INTO CONGVIEC VALUES ('CV00004', N'Thay gương chiếu hậu')
INSERT INTO CONGVIEC VALUES ('CV00005', N'Vá xe')
INSERT INTO CONGVIEC VALUES ('CV00006', N'Thay vỏ xe')
INSERT INTO CONGVIEC VALUES ('CV00007', N'Thay ắc quy')
INSERT INTO CONGVIEC VALUES ('CV00008', N'Thay bugi')
INSERT INTO CONGVIEC VALUES ('CV00009', N'Thay túi chống sốc')
INSERT INTO CONGVIEC VALUES ('CV00010', N'Thay đèn xe')
INSERT INTO CONGVIEC VALUES ('CV00011', N'Thay kính xe')
INSERT INTO CONGVIEC VALUES ('CV00012', N'Bảo dưỡng toàn bộ')
GO

-----------------------------------------------------------------------------------
-- Tạo cấu trúc bảng HOPDONG
CREATE TABLE HOPDONG(
	SoHD		CHAR(10) PRIMARY KEY,
	NgayHD		DATE,
	MaKH		CHAR(10),
	SoXe		CHAR(20),
	TriGiaHD	INT,
	NgayGiaoDK	DATE,
	NgayNgThu	DATE
)
GO

-----------------------------------------------------------------------------------
-- Nhập dữ liệu cho bảng HOPDONG
INSERT INTO HOPDONG VALUES ('HD00001', '2002-12-01', 'KH00001', '0000000000', 5000000, '2002-12-25', '2002-12-28')
INSERT INTO HOPDONG VALUES ('HD00002', '2002-11-28', 'KH00002', '1111111111', 2500000, '2002-12-01', '2002-12-01')
INSERT INTO HOPDONG VALUES ('HD00003', '2002-12-01', 'KH00003', '2222222222', 1800000, '2002-12-01', '2002-12-01')
INSERT INTO HOPDONG VALUES ('HD00004', '2002-12-11', 'KH00004', '3333333333', 2300000, '2002-12-11', '2002-12-11')
INSERT INTO HOPDONG VALUES ('HD00005', '2002-12-05', 'KH00005', '4444444444', 4800000, '2002-12-25', '2002-12-28')
INSERT INTO HOPDONG VALUES ('HD00006', '2002-11-28', 'KH00006', '5555555555', 4200000, '2002-12-18', '2002-12-20')
INSERT INTO HOPDONG VALUES ('HD00007', '2002-12-01', 'KH00007', '6666666666', 6500000, '2002-12-25', '2002-12-28')
INSERT INTO HOPDONG VALUES ('HD00008', '2003-01-02', 'KH00008', '7777777777', 1500000, '2003-01-02', '2003-01-02')
INSERT INTO HOPDONG VALUES ('HD00009', '2003-01-02', 'KH00009', '8888888888', 1600000, '2003-01-02', '2003-01-02')
INSERT INTO HOPDONG VALUES ('HD00010', '2002-12-31', 'KH00010', '9999999999', 3700000, '2003-01-05', '2002-01-07')
GO

-----------------------------------------------------------------------------------
-- Tạo cấu trúc bảng KHACHHANG
CREATE TABLE KHACHHANG(
	MaKH		CHAR(10) PRIMARY KEY,
	TenKH		NVARCHAR(30),
	DiaChi		NVARCHAR(40),
	DienThoai	VARCHAR(15)
)
GO

-----------------------------------------------------------------------------------
-- Nhập dữ liệu cho bảng KHACHHANG
INSERT INTO KHACHHANG VALUES ('KH00001', N'Nguyễn Thanh Phong', N'123 - Võ Văn Ngân - Thủ Đức', '0123456789')
INSERT INTO KHACHHANG VALUES ('KH00002', N'Lê Thị Thanh Hằng', N'24 Lê Văn Việt - Quận 9', '0123948090')
INSERT INTO KHACHHANG VALUES ('KH00003', N'Lê Thảo Nguyên', N'Dĩ An', '0934512987')
INSERT INTO KHACHHANG VALUES ('KH00004', N'Phan Đình Tuấn', N'Thủ Đức', '09352776122')
INSERT INTO KHACHHANG VALUES ('KH00005', N'Cao Văn Pháp', N'QUận 2', '0892483345')
INSERT INTO KHACHHANG VALUES ('KH00006', N'Lý Chiến Thắng', N'34 Dân Chủ - Thủ Đức', '08877934728')
INSERT INTO KHACHHANG VALUES ('KH00007', N'Nguyễn Lê Phương', N'37 Bác Ái - Thủ Đức', '0982311276')
INSERT INTO KHACHHANG VALUES ('KH00008', N'Trần Thanh Tiến', N'Thủ Đức', '0976555123')
INSERT INTO KHACHHANG VALUES ('KH00009', N'Phan Kim Tuyết', N'Thủ Đức', '0976382998')
INSERT INTO KHACHHANG VALUES ('KH00010', N'Cao Mỹ Kim', N'Quận 9', '0982225671')
GO

-----------------------------------------------------------------------------------
-- Thêm khóa ngoại cho bảng HOPDONG
ALTER TABLE HOPDONG WITH CHECK ADD FOREIGN KEY(MaKH) REFERENCES KHACHHANG(MaKH)
GO

-----------------------------------------------------------------------------------
-- Tạo cấu trúc bảng CHITIET_HD
CREATE TABLE CHITIET_HD(
	SoHD	 CHAR(10) REFERENCES HOPDONG(SoHD),
	MaCV	 CHAR(10) REFERENCES CONGVIEC(MaCV),
	TriGiaCV INT,
	MaTho	 CHAR(10) REFERENCES THO(MaTho),
	KhoanTho INT,
	PRIMARY KEY (SoHD, MaCV)
)
GO

-----------------------------------------------------------------------------------
-- Nhập dữ liệu cho bảng CHITIET_HD
INSERT INTO CHITIET_HD VALUES ('HD00001', 'CV00006', 5000000, 'T005', 5000000)
INSERT INTO CHITIET_HD VALUES ('HD00002', 'CV00011', 2500000, 'T002', 2500000)
INSERT INTO CHITIET_HD VALUES ('HD00003', 'CV00010', 1800000, 'T003', 1800000)
INSERT INTO CHITIET_HD VALUES ('HD00004', 'CV00009', 2300000, 'T003', 2300000)
INSERT INTO CHITIET_HD VALUES ('HD00005', 'CV00008', 4800000, 'T007', 4800000)
INSERT INTO CHITIET_HD VALUES ('HD00006', 'CV00007', 4200000, 'T010', 4200000)
INSERT INTO CHITIET_HD VALUES ('HD00007', 'CV00012', 5000000, 'T008', 5000000)
INSERT INTO CHITIET_HD VALUES ('HD00007', 'CV00001', 1500000, 'T003', 1500000)
INSERT INTO CHITIET_HD VALUES ('HD00008', 'CV00001', 1500000, 'T004', 1500000)
INSERT INTO CHITIET_HD VALUES ('HD00009', 'CV00005', 1600000, 'T004', 1600000)
INSERT INTO CHITIET_HD VALUES ('HD00010', 'CV00002', 3700000, 'T001', 3700000)
GO

-----------------------------------------------------------------------------------
-- Tạo cấu trúc bảng PHIEUTHU
CREATE TABLE PHIEUTHU(
	SoPT		CHAR(10) PRIMARY KEY,
	NgayLapPT	DATE,
	SoHD		CHAR(10) REFERENCES HOPDONG(SoHD),
	MaKH		CHAR(10) REFERENCES KHACHHANG(MaKH),
	HoTen		NVARCHAR(30),
	SoTienThu	INT
)
GO

-----------------------------------------------------------------------------------
-- Nhập dữ liệu cho bảng PHIEUTHU
INSERT INTO PHIEUTHU VALUES ('PT00001', '2002-12-01', 'HD00002', 'KH00002', N'Nguyễn Văn A', 2500000)
INSERT INTO PHIEUTHU VALUES ('PT00002', '2002-12-01', 'HD00003', 'KH00003', N'Lê Thảo Nguyên', 1800000)
INSERT INTO PHIEUTHU VALUES ('PT00003', '2002-12-11', 'HD00004', 'KH00004', N'Phan Đình Tuấn', 2300000)
INSERT INTO PHIEUTHU VALUES ('PT00004', '2002-12-18', 'HD00006', 'KH00006', N'Lý Chiến Thắng', 3000000)
INSERT INTO PHIEUTHU VALUES ('PT00005', '2002-12-20', 'HD00006', 'KH00006', N'Lý Chiến Thắng', 1200000)
INSERT INTO PHIEUTHU VALUES ('PT00006', '2002-12-25', 'HD00005', 'KH00005', N'Cao Văn Pháp', 3000000)
INSERT INTO PHIEUTHU VALUES ('PT00007', '2002-12-25', 'HD00007', 'KH00007', N'Nguyễn Lê Phương', 4000000)
INSERT INTO PHIEUTHU VALUES ('PT00008', '2002-12-28', 'HD00007', 'KH00007', N'Nguyễn Lê Phương', 1500000)
INSERT INTO PHIEUTHU VALUES ('PT00009', '2002-12-28', 'HD00001', 'KH00001', N'Nguyễn Thanh Phong', 5000000)
INSERT INTO PHIEUTHU VALUES ('PT00010', '2002-12-28', 'HD00005', 'KH00005', N'Cao Văn Pháp', 1800000)
INSERT INTO PHIEUTHU VALUES ('PT00011', '2003-01-02', 'HD00008', 'KH00008', N'Trần Thanh Tiến', 1500000)
INSERT INTO PHIEUTHU VALUES ('PT00012', '2003-01-02', 'HD00009', 'KH00009', N'Phan Kim Tuyết', 1600000)
INSERT INTO PHIEUTHU VALUES ('PT00013', '2003-01-05', 'HD00010', 'KH00010', N'Trần Văn B', 2000000)
INSERT INTO PHIEUTHU VALUES ('PT00014', '2003-01-07', 'HD00010', 'KH00010', N'Cao Mỹ Kim', 1700000)
GO